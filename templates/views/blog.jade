extends ../layouts/blog/default


block content
	.container.blog-section(style={'margin-top': '60px'})
		.col-md-offset-3.col-md-6
			.blog-form.form
				.input-group
					input#emailControl.form-control(type='email', placeholder='Type your email here', value='')
					span.input-group-btn
						button.btn.btn-default.subscribe-btn Subscribe
				p.info-message(style={display: 'none', 'text-align': 'center', 'margin-top': '10px'}) Successfully subscribed
		if data.posts.featured.length
			each post,key in locals.data.posts.featured
				.col-md-offset-1.col-md-10(style=key === 0 ? 'margin-top: 60px;' : 'margin-top: 3px;')
					.col-md-6.col-sm-12
						.row
							img.blog-img.img-responsive(src=post.image.url, alt='')
					.col-md-6.col-sm-12
						.row
							.blog-info-transparent
							.col-md-10.col-sm-10.blog-info
								p.blog-date=moment(post.publishedDate).format('LL')
								p.blog-title=post.title
								div.blog-desc-featured!=post.content.extended
							.blog-actions-content
								.blog-actions
									if post.link
										a.btn.sign-up-btn(href=post.link ? post.link : '', target="_blank") Go To Experience
									else
										a.btn.sign-up-btn Go To Experience

		if data.posts.random.length
			each post,key in locals.data.posts.random
				.col-md-12.col-sm-12.col-lg-12.blog-item-content
					.col-md-offset-2.col-md-8.col-sm-12.blog-info
						p.blog-date=moment(post.publishedDate).format('LL')
						h1.blog-title
							a(href=`/post/${post._id}`)=post.title
						div.blog-desc!=post.content.extended
						if post.tags
							.tag-section
								ul
									each tag in post.tags
										li
											a(href=`/${tag.name}`)=tag.name
		script(src='/js/jquery/jquery-1.11.3.min.js')
		script.
			pattern = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
			$('#emailControl').on('input', function(e){
				if(!pattern.test(e.target.value)){
					e.target.style.borderColor = 'rgba(255, 0, 0, 0.5)'
				}else {
					e.target.style.borderColor = '#2b542c'
				}
				if(e.target.value == "") {
					e.target.style.borderColor = 'rgba(0, 139, 242, 0.5)'
				}
			})
			api = "#{apiRoute}"
			$('.subscribe-btn').click(function ($event) {
				$event.preventDefault()
				if(pattern.test($('#emailControl')[0].value)) {
					$.post(api + '/blog/subscribe', {email: $('#emailControl')[0].value})
							.done((result) => {
						$('#emailControl')[0].style.display = 'none';
						$('.subscribe-btn')[0].innerText = 'Subscribed'
						$('.subscribe-btn')[0].disabled = true
						$('.subscribe-btn').css({
							width:'100%',
							'max-width':'100%',
							'border-radius':'50px',
						})
					})
				.fail((xhr, status, error) => {
						let data = JSON.parse(xhr.responseText);
						$('.info-message')[0].innerText = data.error.message || error.message;
						$('.info-message').fadeIn()
						$('.info-message')[0].style.color = '#008BF2'
					$('.info-message').fadeOut(3000)

				})
				}
				
			})
